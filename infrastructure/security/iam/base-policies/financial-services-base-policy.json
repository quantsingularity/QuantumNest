{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyRootAccess",
            "Effect": "Deny",
            "Principal": {
                "AWS": "arn:aws:iam::*:root"
            },
            "Action": "*",
            "Resource": "*",
            "Condition": {
                "Bool": {
                    "aws:MultiFactorAuthPresent": "false"
                }
            }
        },
        {
            "Sid": "RequireMFAForConsoleAccess",
            "Effect": "Deny",
            "Action": ["ec2:*", "rds:*", "s3:*", "iam:*", "kms:*"],
            "Resource": "*",
            "Condition": {
                "Bool": {
                    "aws:MultiFactorAuthPresent": "false"
                },
                "StringEquals": {
                    "aws:RequestedRegion": ["us-east-1", "us-west-2", "eu-west-1"]
                }
            }
        },
        {
            "Sid": "DenyUnencryptedObjectUploads",
            "Effect": "Deny",
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::quantumnest-*/*",
            "Condition": {
                "StringNotEquals": {
                    "s3:x-amz-server-side-encryption": ["AES256", "aws:kms"]
                }
            }
        },
        {
            "Sid": "EnforceSSLRequestsOnly",
            "Effect": "Deny",
            "Action": "s3:*",
            "Resource": ["arn:aws:s3:::quantumnest-*", "arn:aws:s3:::quantumnest-*/*"],
            "Condition": {
                "Bool": {
                    "aws:SecureTransport": "false"
                }
            }
        },
        {
            "Sid": "RestrictRegionalAccess",
            "Effect": "Deny",
            "Action": "*",
            "Resource": "*",
            "Condition": {
                "StringNotEquals": {
                    "aws:RequestedRegion": ["us-east-1", "us-west-2", "eu-west-1"]
                }
            }
        },
        {
            "Sid": "RequireTagsForResourceCreation",
            "Effect": "Deny",
            "Action": ["ec2:RunInstances", "rds:CreateDBInstance", "s3:CreateBucket"],
            "Resource": "*",
            "Condition": {
                "Null": {
                    "aws:RequestTag/Environment": "true",
                    "aws:RequestTag/Owner": "true",
                    "aws:RequestTag/CostCenter": "true",
                    "aws:RequestTag/DataClassification": "true"
                }
            }
        },
        {
            "Sid": "AuditTrailProtection",
            "Effect": "Deny",
            "Action": [
                "cloudtrail:StopLogging",
                "cloudtrail:DeleteTrail",
                "cloudtrail:PutEventSelectors"
            ],
            "Resource": "*",
            "Condition": {
                "StringNotLike": {
                    "aws:userid": [
                        "AIDACKCEVSQ6C2EXAMPLE:security-admin",
                        "AIDACKCEVSQ6C2EXAMPLE:compliance-officer"
                    ]
                }
            }
        }
    ]
}
